import Java.io.File;
 import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.NET.MalformedURLException;
 import java.Net.URL;
 import java.net.URLConnection;
 import java.text.SimpleDateFormat;
 import java.util.Date;
 import java.util.HashSet;
 import java.util.LinkedList;
 import java.util.Set;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 import org.jsoup.Jsoup;
 import org.jsoup.nodes.Document;
 import org.jsoup.nodes.Element;
 import org.jsoup.select.Elements;

 public class newCrawl {
  public LinkedList ImgUrls=new LinkedList();//ç”¨äºå­˜æ”¾å›¾ç‰‡URL
  public LinkedList linkurls=new LinkedList();//ç”¨äºå­˜æ”¾urlé“¾æ¥

  public static void main(String[] args) throws IOException {  
    newCrawl newCl = new newCrawl();   

    String url="http://world.huanqiu.com/article/2016-01/8412590.html?from=bdwz";
             Document doc = Jsoup.connect(url).get();
<<<<<<< HEAD
             newCl.downloadPage(url);//ÏÂÔØÍøÒ³ 
             String title=newCl.getnewTitle(doc);//»ñÈ¡ĞÂÎÅ±êÌâ
            String time=newCl.getTime(doc);//»ñÈ¡ĞÂÎÅ·¢²¼Ê±¼ä
            String text=newCl.getNewtext(doc);//»ñÈ¡ĞÂÎÅÄÚÈİ
    System.out.println("ĞÂÎÅUrl:"+url);
    System.out.println("ĞÂÎÅ±êÌâ:"+title);
    
    System.out.println("ĞÂÎÅÄÚÈİ:"+text);
=======
             newCl.downloadPage(url);//ä¸‹è½½ç½‘é¡µ 
             String title=newCl.getnewTitle(doc);//è·å–æ–°é—»æ ‡é¢˜
            String time=newCl.getTime(doc);//è·å–æ–°é—»å‘å¸ƒæ—¶é—´
            String text=newCl.getNewtext(doc);//è·å–æ–°é—»å†…å®¹
    System.out.println("æ–°é—»Url:"+url);
    System.out.println("æ–°é—»æ ‡é¢˜:"+title);
    System.out.printLN();
    //System.out.println("newsTime:"+time);
    System.out.println("æ–°é—»å†…å®¹:"+text);
>>>>>>> 4c158d56f22cf170370e3e0eb139de8172c7348e
    System.out.println("******************************************************************");

    newCl.getImgurl(doc);//è·å–å›¾ç‰‡é“¾æ¥
    newCl.getlinkurl(doc);//è·å–ç½‘é¡µé“¾æ¥
    System.out.println("å›¾ç‰‡urlé“¾æ¥");
    for (Object IU : newCl.ImgUrls) {
         System.out.println(IU);
       } 

    System.out.println("*****************************************************************");
    System.out.println("urlé“¾æ¥");
    for (Object LU : newCl.linkurls) {
         System.out.println(LU);
       }
   }  
   
   public String getnewTitle(Document doc){
    //è·å–ç½‘é¡µçš„æ ‡é¢˜
    String title=doc.title();
    return title;
   }
   public LinkedList getlinkurl(Document doc) throws IOException{
    //è·å–ç½‘é¡µä¸­çš„æ‰€æœ‰urlåœ°å€ï¼Œå¹¶ä¿å­˜åœ¨linkurlsé“¾è¡¨ä¸­
    Elements href = doc.select("a[href]");
    for (Element hre : href) {
             String linkUrl = hre.attr("abs:href");//è·å–ç½‘é¡µçš„ç»å¯¹åœ°å€
             if(!linkurls.contains(linkUrl)){
             linkurls.add(linkUrl);
             // System.out.println(linkUrl);
             }
           }
    return linkurls;
   }
   public LinkedList getImgurl(Document doc) throws IOException{
    //è·å–å›¾ç‰‡åœ°å€ï¼Œå¹¶ä¿å­˜åœ¨ImgUrlsé“¾è¡¨ä¸­
    int count=0;
    Elements pngs = doc.select("img[src]");
    for (Element img : pngs) {
    count++;
             String imgUrl = img.attr("abs:src");//è·å–å›¾ç‰‡çš„ç»å¯¹è·¯å¾„
             // imgUrl = img.absUrl("src");
              ImgUrls.add(imgUrl);
              //System.out.println(imgUrl);
              downloadImg(imgUrl,count);
           }
    return ImgUrls;
   }
   public void  downloadImg(String ImgUrl,int count) throws IOException{
    //ä¸‹è½½å›¾ç‰‡
    String str="F:\\MyEclipse\\Img\\";//ä¿å­˜ä¸‹è½½å›¾ç‰‡æ–‡ä»¶å¤¹
    String ss=str+count+".png";//ä¿å­˜å›¾ç‰‡è·¯å¾„
    URL url=new URL(ImgUrl);  // æ„é€ URL
    URLConnection uc=url.openConnection(); // æ‰“å¼€è¿æ¥
    InputStream is=uc.getInputStream(); // è¾“å…¥æµ
    File file=new File(ss); //åˆ›å»ºæ–‡ä»¶
    FileOutputStream out=new FileOutputStream(file);  // è¾“å‡ºçš„æ–‡ä»¶æµ
     byte[] bs = new byte[1024];
       // è¯»å–åˆ°çš„æ•°æ®é•¿åº¦
       int len;
       // å¼€å§‹è¯»å–
       while ((len = is.read(bs)) != -1) {
       out.write(bs, 0, len);
       }
       // å®Œæ¯•ï¼Œå…³é—­æ‰€æœ‰é“¾æ¥
       out.close();
       is.close();
   }
   
   public String getNewtext(Document doc){
    //è·å–æ–°é—»å†…å®¹
            String text = doc.select("div.text").text(); 
             text=text.replace(Jsoup.parse("   ").text(), "");
             return text;
   }
   
   public String getTime(Document doc){
    //è·å–æ–°é—»å‘å¸ƒçš„æ—¶é—´
    String time=null;
    Elements element=doc.select("strong.timeSummary");//æ­¤å¤„æ˜¯æ ¹æ®ç™¾åº¦æ–°é—»çš„ç½‘é¡µå½¢å¼è§£æçš„æ–°é—»æ—¶é—´
           String rex="^(((20\\d{2})-(\\d{2})-(\\d{2}))) ((\\d{2}):(\\d{2}):(\\d{2}))$";//æ­£åˆ™è¡¨è¾¾å¼ç”¨äºåŒ¹é…æ—¶é—´
           Pattern pattern=Pattern.compile(rex);
           for(Element el: element){
             String content = el.text();
             Matcher matcher=pattern.matcher(content);
             if(matcher.matches()){
             time=content;
             System.out.println("æ–°é—»å‘å¸ƒæ—¶é—´ä¸ºï¼š"+content);
             }
           }
           return time;
   }
   
   public static void downloadPage(String str){
    //ä¸‹è½½ç½‘é¡µ
    String filestr="F:/test";//è®¾ç½®ç½‘é¡µçš„ä¿å­˜åœ°å€
    try {
            URL pageUrl = new URL(str);
            URLConnection uc =pageUrl.openConnection(); // æ‰“å¼€è¿æ¥     
            String path = pageUrl.getPath();//è·å–ç½‘é¡µçš„ç›¸å¯¹è·¯å¾„
          //  System.out.println(path);
            if (path.length() == 0) {//å¯¹ç½‘é¡µçš„ç›¸å¯¹è·¯å¾„è¿›è¡Œå¤„ç†
                path = "index.html";
            } else {
                if (path.endsWith("/")) {
                    path = path + "index.html";
                } else {
                    int lastSlash = path.lastIndexOf("/");
                    int lastPoint = path.lastIndexOf(".");
                    if (lastPoint < lastSlash) {
                        path = path + ".html";
                    }
                }
            }
            filestr=filestr+path;//ç½‘é¡µä¿å­˜è·¯å¾„
            System.out.println("ç½‘é¡µä¿å­˜è·¯å¾„ï¼š"+filestr);
            //è®¾ç½®ç½‘é¡µä¿å­˜ç›®å½•ï¼Œå½“ä¿å­˜ç½‘é¡µçš„æ–‡ä»¶å¤¹ä¸å­˜åœ¨æ—¶ï¼Œéœ€è¦å…ˆåˆ›å»ºæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨ä¿å­˜ç½‘é¡µ
            int lastSlash2 = filestr.lastIndexOf("/");
            String filestrr=filestr.substring(0,lastSlash2);
           // System.out.println(filestrr); 
     File file2=new File(filestrr); //åˆ›å»ºæ–‡ä»¶ç›®å½•
     file2.mkdirs();
   File file=new File(filestr); //åˆ›å»ºæ–‡ä»¶ 
   InputStream is=uc.getInputStream(); // è¾“å…¥æµ
   FileOutputStream out=new FileOutputStream(file);  // è¾“å‡ºçš„æ–‡ä»¶æµ
    byte[] bs = new byte[1024];
      // è¯»å–åˆ°çš„æ•°æ®é•¿åº¦
      int len;
      // å¼€å§‹è¯»å–
      while ((len = is.read(bs)) != -1) {
      
out.write(bs, 0, len);
      }
      // å®Œæ¯•ï¼Œå…³é—­æ‰€æœ‰é“¾æ¥
      out.close();
      is.close();
        } catch (Exception ex) {
        }      
   }
 }  
